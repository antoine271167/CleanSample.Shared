parameters:
  - name: azureSubscription
    type: string
  - name: resourceGroup
    type: string
  - name: workspaceName
    type: string
  - name: location
    type: string
    default: westeurope
  - name: retentionTime
    type: number
    default: 730

steps:
- task: AzureCLI@2
  displayName: 'Create log analytics workspace'
  inputs:
    azureSubscription: ${{parameters.azureSubscription}}
    scriptType: bash
    scriptLocation: inlineScript
    inlineScript: |
      echo "Deploying log analytics workspace ${{parameters.workspaceName}}"
      az monitor log-analytics workspace create \
        --resource-group ${{parameters.resourceGroup}} \
        --workspace-name ${{parameters.workspaceName}} \
        --retention-time ${{parameters.retentionTime}} \
        --location ${{parameters.location}}