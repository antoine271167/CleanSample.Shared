parameters:
- name: azureSubscription
  type: string
- name: keyVaultName
  type: string
- name: secrets 
  type: object 
- name: env 
  type: object 
- name: beforeSecretsUpdate
  type: stepList
  default: []

jobs:
- job: UpdateSecrets
  displayName: Update secrets
  steps:
  - ${{ parameters.beforeSecretsUpdate }}
  - ${{ each secret in parameters.secrets }}: 
    - template: ../task/keyvault-secret-set-task.yml
      parameters:
        azureSubscription: ${{parameters.azureSubscription}}
        keyVaultName: ${{parameters.keyVaultName}}
        name: ${{secret.name}}
        value: ${{secret.value}}
        env: ${{parameters.env}}